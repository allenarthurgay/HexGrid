<html>
	<body onload="render()">
        <canvas id="canvas" width="800" height="600" style="border: 1px solid #000" onmousedown="doPickHex(event)">
        </canvas>
        <script type="text/javascript" src="glMatrix-0.9.5.min.js"></script>

        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying vec4 vColor;

            void main(void) {
                gl_FragColor = vColor;
            }
        </script>

        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec4 aVertexColor;

            uniform mat4 uMVMatrix;
            uniform mat4 uPMatrix;

            varying vec4 vColor;

            void main(void) {
                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                vColor = aVertexColor;
            }
        </script>

        <script type="text/javascript" src="./hexgrid.js"></script>
		<script type="text/javascript">
            // thanks javascript % bug...
            // taken from: http://javascript.about.com/od/problemsolving/a/modulobug.htm
            Number.prototype.mod = function(n) {
                return ((this%n)+n)%n;
            }

			var c = document.getElementById('canvas');

            var gridWidth = 7;
            var gridHeight = 6;

            var hexGrid = new HexGrid(c,true);
            var hexes = 13;
            var x = 0;
            var y = 0;

            function nextX() {
                return (x+1).mod(gridWidth);
            }
            function nextY() {
                return x == 0 ? (y+1).mod(gridHeight) : y;
            }

            hexGrid.update = function() {
                var rx = (x-hexes).mod(gridWidth);
                var ry = (y - Math.floor((rx + hexes)/gridWidth)).mod(gridHeight);
                hexGrid.add(x,y);
                hexGrid.remove(rx,ry);
                x = nextX();
                y = nextY();
            }

            for(var i = -1; i < 2; ++i) {
                for(var j = -1; j < 2; ++j) {
                    hexGrid.add(i,j);
                }
            }

			function render() {
				//hexGrid.update();
                hexGrid.renderOneFrame();
				window.setTimeout(render, 80);
			}

            function doPickHex(event) {
                var x = event.offsetX, y = event.offsetY;
                console.log("screen: ", x, y);
                hexGrid.pickHex(x,y)
            }
            document.onkeydown = function(e) {
                var event = window.event ? window.event : e;

                if(event.keyCode == 39) {
                    cam_x = cam_x + 1;
                }
                else if(event.keyCode == 37) {
                    cam_x = cam_x - 1;
                }
                else if(event.keyCode == 38){
                    cam_y = cam_y + 1;
                }
                else if(event.keyCode == 40){
                    cam_y = cam_y - 1;
                }
                else if(event.keyCode == 65){
                    cam_z = cam_z - 1;
                }
                else if(event.keyCode == 90){
                    cam_z = cam_z + 1;
                }
                else if(event.keyCode == 83){
                    degree = degree - 5;
                }
                else if(event.keyCode == 88){
                    degree = degree + 5;
                }
                console.log(cam_x + ', ' + cam_y + ', ' + cam_z)
            }
		</script>
	</body>
</html>

